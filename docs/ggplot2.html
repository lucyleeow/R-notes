<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 8 ggplot2 | R notes</title>
  <meta name="description" content="Guide to R.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 8 ggplot2 | R notes />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Guide to R." />
  <meta name="github-repo" content="lucyleeow/R_notes" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 ggplot2 | R notes />
  
  <meta name="twitter:description" content="Guide to R." />
  

<meta name="author" content="Lucy Liu">


<meta name="date" content="2018-12-20">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="base-r.html">
<link rel="next" href="other-visualisation-packages.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R notes</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="data-wrangling-base-r.html"><a href="data-wrangling-base-r.html"><i class="fa fa-check"></i><b>3</b> Data wrangling - base R</a></li>
<li class="chapter" data-level="4" data-path="data-wrangling-dplyr.html"><a href="data-wrangling-dplyr.html"><i class="fa fa-check"></i><b>4</b> Data wrangling - dplyr</a></li>
<li class="chapter" data-level="5" data-path="for-loops.html"><a href="for-loops.html"><i class="fa fa-check"></i><b>5</b> For loops</a></li>
<li class="chapter" data-level="6" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>6</b> Functions</a></li>
<li class="chapter" data-level="7" data-path="base-r.html"><a href="base-r.html"><i class="fa fa-check"></i><b>7</b> Base R</a></li>
<li class="chapter" data-level="8" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>8</b> ggplot2</a><ul>
<li class="chapter" data-level="8.1" data-path="ggplot2.html"><a href="ggplot2.html#introduction-1"><i class="fa fa-check"></i><b>8.1</b> Introduction</a><ul>
<li class="chapter" data-level="8.1.1" data-path="ggplot2.html"><a href="ggplot2.html#geoms"><i class="fa fa-check"></i><b>8.1.1</b> geoms</a></li>
<li class="chapter" data-level="8.1.2" data-path="ggplot2.html"><a href="ggplot2.html#layering"><i class="fa fa-check"></i><b>8.1.2</b> Layering</a></li>
<li class="chapter" data-level="8.1.3" data-path="ggplot2.html"><a href="ggplot2.html#aesthetics"><i class="fa fa-check"></i><b>8.1.3</b> Aesthetics</a></li>
<li class="chapter" data-level="8.1.4" data-path="ggplot2.html"><a href="ggplot2.html#syntax"><i class="fa fa-check"></i><b>8.1.4</b> Syntax</a></li>
<li class="chapter" data-level="8.1.5" data-path="ggplot2.html"><a href="ggplot2.html#stat"><i class="fa fa-check"></i><b>8.1.5</b> Stat</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="ggplot2.html"><a href="ggplot2.html#geom_point"><i class="fa fa-check"></i><b>8.2</b> geom_point</a><ul>
<li class="chapter" data-level="8.2.1" data-path="ggplot2.html"><a href="ggplot2.html#jitter"><i class="fa fa-check"></i><b>8.2.1</b> Jitter</a></li>
<li class="chapter" data-level="8.2.2" data-path="ggplot2.html"><a href="ggplot2.html#labels"><i class="fa fa-check"></i><b>8.2.2</b> Labels</a></li>
<li class="chapter" data-level="8.2.3" data-path="ggplot2.html"><a href="ggplot2.html#colour-points"><i class="fa fa-check"></i><b>8.2.3</b> Colour points</a></li>
<li class="chapter" data-level="8.2.4" data-path="ggplot2.html"><a href="ggplot2.html#matrix-of-plots"><i class="fa fa-check"></i><b>8.2.4</b> Matrix of plots</a></li>
<li class="chapter" data-level="8.2.5" data-path="ggplot2.html"><a href="ggplot2.html#adding-lines"><i class="fa fa-check"></i><b>8.2.5</b> Adding lines</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="ggplot2.html"><a href="ggplot2.html#bar-graphs-histograms"><i class="fa fa-check"></i><b>8.3</b> Bar graphs &amp; histograms</a></li>
<li class="chapter" data-level="8.4" data-path="ggplot2.html"><a href="ggplot2.html#geom_boxplot"><i class="fa fa-check"></i><b>8.4</b> geom_boxplot</a></li>
<li class="chapter" data-level="8.5" data-path="ggplot2.html"><a href="ggplot2.html#facets"><i class="fa fa-check"></i><b>8.5</b> Facets</a></li>
<li class="chapter" data-level="8.6" data-path="ggplot2.html"><a href="ggplot2.html#reordering-factors"><i class="fa fa-check"></i><b>8.6</b> Reordering factors</a></li>
<li class="chapter" data-level="8.7" data-path="ggplot2.html"><a href="ggplot2.html#coordinate-systems"><i class="fa fa-check"></i><b>8.7</b> Coordinate systems</a></li>
<li class="chapter" data-level="8.8" data-path="ggplot2.html"><a href="ggplot2.html#reference-lines"><i class="fa fa-check"></i><b>8.8</b> Reference lines</a></li>
<li class="chapter" data-level="8.9" data-path="ggplot2.html"><a href="ggplot2.html#error-bars"><i class="fa fa-check"></i><b>8.9</b> Error bars</a></li>
<li class="chapter" data-level="8.10" data-path="ggplot2.html"><a href="ggplot2.html#appearance"><i class="fa fa-check"></i><b>8.10</b> Appearance</a></li>
<li class="chapter" data-level="8.11" data-path="ggplot2.html"><a href="ggplot2.html#dplyr-ggplot2"><i class="fa fa-check"></i><b>8.11</b> dplyr &amp; ggplot2</a></li>
<li class="chapter" data-level="8.12" data-path="ggplot2.html"><a href="ggplot2.html#saving-graphs"><i class="fa fa-check"></i><b>8.12</b> Saving graphs</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="other-visualisation-packages.html"><a href="other-visualisation-packages.html"><i class="fa fa-check"></i><b>9</b> Other visualisation packages</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ggplot2" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> ggplot2</h1>
<p>Useful references:</p>
<ul>
<li><a href="https://www.ggplot2-exts.org">ggplot2 extensions</a></li>
<li><a href="http://ggplot2.tidyverse.org/reference/">Theory of ggplot</a></li>
<li><a href="https://rstudio-pubs-static.s3.amazonaws.com/3364_d1a578f521174152b46b19d0c83cbe7e.html">Themes</a></li>
</ul>
<div id="introduction-1" class="section level2">
<h2><span class="header-section-number">8.1</span> Introduction</h2>
<p>The general syntax of a ggplot2 call:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="op">&lt;</span>DATA<span class="op">&gt;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="er">&lt;</span>GEOM_FUNCTION<span class="op">&gt;</span>(
     <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="op">&lt;</span>MAPPINGS<span class="op">&gt;</span>),
     <span class="dt">stat =</span> <span class="op">&lt;</span>STAT<span class="op">&gt;</span>,    <span class="co">#statistical transformation</span>
     <span class="dt">position =</span> <span class="op">&lt;</span>POSITION<span class="op">&gt;</span>) <span class="op">+</span>
<span class="st">  </span><span class="er">&lt;</span>COORDINATE_FUNCTION<span class="op">&gt;</span><span class="st"> </span><span class="op">+</span>
<span class="st">  </span><span class="er">&lt;</span>FACET_FUNCTION<span class="op">&gt;</span></code></pre></div>
<p>There are 7 parameters to specify but you will rarely have to specify all 7 parameters as ggplot has useful defaults.</p>
<div id="geoms" class="section level3">
<h3><span class="header-section-number">8.1.1</span> geoms</h3>
<p>Different types of graphs are called different ‘geoms’, as they can be thought of geometrical objects used to represent data. E.g.:</p>
<ul>
<li>geom_bar = bar graph</li>
<li>geom_line = line graph</li>
<li>geom_boxplot = box plot<br />
</li>
<li>geom_point = scatter plot</li>
<li>geom_smooth = smooth line fitted to the data</li>
</ul>
</div>
<div id="layering" class="section level3">
<h3><span class="header-section-number">8.1.2</span> Layering</h3>
<p>Think of ggplot2 as creating a plot using layers. Here is a simple scatter plot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>We can break this down into ‘layers’.</p>
<p>This creates an empty graph:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data=</span>mpg)</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>geom_point() creates a scatter plot on top of the empty base. ‘mapping’ is an argument you beed to define. It maps variable to a way to show it on graph or ‘defines how variables in your dataset are mapped to visual properties’.</p>
<p>Mapping is always paired with aes() and the x and y arguments of aes(), which specify which variable is x and which one is y.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="aesthetics" class="section level3">
<h3><span class="header-section-number">8.1.3</span> Aesthetics</h3>
<p>The specific <code>mapping = aes()</code> options vary depending on the type of geom. For geom_point, the following mapping options are available:</p>
<ul>
<li>colour - colour of the points.</li>
<li>size - where each dot will be different sizes depending on the class it belongs to. You can also control the min and max range of point sizes with: <code>scale_size_continuous/discrete(range = c(2,4))</code> - depending on whether the variable is continuous or discrete.</li>
<li>alpha - transparency of points.</li>
<li>shape - shape of the points. ggplot2 will only use 6 shapes at a time. By default additional groups will be unplotted</li>
</ul>
<p>A different variable can be mapped to each of these aesthetics. ggplot selects a reasonable scale and constructs a legend.</p>
<p>(The dataset <code>mpg</code> will be used in this section)</p>
<p>Here colour is mapped to the variable (column) class.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> class))</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>You can also set aesthetics manually. Do this by mapping aesthetic name <em>outside of</em> the <code>aes()</code> function.</p>
<p>This makes all the points blue:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy), <span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>)</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<ul>
<li>size - you can specify size of all points in mm</li>
<li>shape - specify using a number code. The shapes available are: <img src="Images/shapes-1.png" /></li>
<li>stroke - for shapes that have a border, this dictates the size of the border, in mm.</li>
</ul>
<p>Here we add a border to all the points:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">stroke =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">4</span>, 
             <span class="kw">aes</span>(<span class="dt">fill =</span> <span class="kw">factor</span>(drv)))</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>It is important to note the difference between mapping an aesthetic within <code>aes()</code> and outside of <code>aes()</code> -</p>
<ul>
<li>within <code>aes()</code> you can map a <em>variable</em> (or column) to an aesthetic</li>
<li>outside of <code>aes()</code> (but inside a <code>geom</code>) you can only map an aesthetic to a <em>constant value</em></li>
</ul>
<p>(See <a href="https://stackoverflow.com/questions/41863049/when-does-the-aesthetic-go-inside-or-outside-aes">SO</a> for more details)</p>
</div>
<div id="syntax" class="section level3">
<h3><span class="header-section-number">8.1.4</span> Syntax</h3>
<p>If you put mappings at the top in ggplot(), it will use such mapping for everything, ‘global mapping’.</p>
<p>Here the same y and x mappings are used to create points and a smooth line.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>()</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="R_notes_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>The above code means the same as:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))</code></pre></div>
<p>You can still change mappings for specific geoms, even if you have specified a ‘global’ mapping in <code>ggplot()</code> call. If you add mappings to <code>geom_xx()</code>, ggplot2 will overwrite or extend the global mappings given in ggplot() with the local mappings given in geom_xx(). Again we can consider geom() as another layer underneath ggplot(), and any changes are for the layer geom(). Here, we add the colour variable to just the <code>geom_point()</code> layer.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">color =</span> class)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>()</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="R_notes_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>You can also simplify the syntax as <code>data =</code> and <code>mapping =</code> are the first arguments to the <code>ggplot()</code> and <code>geom_xx()</code> functions.</p>
</div>
<div id="stat" class="section level3">
<h3><span class="header-section-number">8.1.5</span> Stat</h3>
<p>Stat stands for statistical transform and is the algorithm used by a geom to calculate the values used for the graphs. You can find the default stat by looking in the help file of that geom.</p>
<p>You can use stat and geom interchangeably. For example, the default stat for <code>geom_bar()</code> is <code>stat_count()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># this code:</span>
<span class="kw">ggplot</span>(iris) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">stat_count</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Species))

<span class="co"># is the same as:</span>
<span class="kw">ggplot</span>(iris) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Species))</code></pre></div>
<p>The help file for <code>geom_bar()</code> will also document what values are computed for this stat. <code>stat_count()</code> computes 2 values: count and prop.</p>
<p>You can override the default stat with the <code>stat</code> argument in <code>geom_xx()</code>. You can also change the default mapping e.g. so that a bar graph of proportion is shown instead of counts.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(iris) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Species, <span class="dt">y =</span> ..prop.., <span class="dt">group =</span> <span class="dv">1</span>))</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Note that proportion is now on the y axis. The argument <code>group = 1</code> means that it will treat all observations as 100% and calculated the proportion of observations in each group. Without this argument, the proportion will be 100% for each group as it will treat each group separately.</p>
</div>
</div>
<div id="geom_point" class="section level2">
<h2><span class="header-section-number">8.2</span> geom_point</h2>
<p>The <code>iris</code> dataset will be used for this section.</p>
<div id="jitter" class="section level3">
<h3><span class="header-section-number">8.2.1</span> Jitter</h3>
<p>A problem with scatter plots is that if there are many values that are the same number (especially if they are rounded), the points will overlap each other and it will be diff to appreciate from the graph where the weight of the points lie. To overcome this you can separate the points by adding a bit of random noise to each point. You can do this in two ways:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy), <span class="dt">position =</span> <span class="st">&quot;jitter&quot;</span>)</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>or in a shorter way (as <code>geom_point(position = &quot;jitter&quot;)</code> = <code>geom_jitter()</code>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))</code></pre></div>
</div>
<div id="labels" class="section level3">
<h3><span class="header-section-number">8.2.2</span> Labels</h3>
<p>To label points, use <code>geom_text</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">y =</span> Petal.Width, <span class="dt">x =</span> Petal.Length)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> iris<span class="op">$</span>Species))</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>If you only wanted to label a few specific points, you can use <code>ifelse()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">y =</span> Petal.Width, <span class="dt">x =</span> Petal.Length)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">ifelse</span>(iris<span class="op">$</span>Petal.Length <span class="op">&gt;</span><span class="st"> </span><span class="fl">6.2</span>, 
                               <span class="kw">as.character</span>(iris<span class="op">$</span>Species), <span class="st">&quot;&quot;</span>)), 
            <span class="dt">hjust =</span> <span class="fl">0.5</span>, <span class="dt">vjust =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Note that in the <code>ifelse()</code> statement, you specify the label to be empty <code>&quot;&quot;</code> if the value (row) does not meet your condition.</p>
<p>The arguments <code>hjust</code> and <code>vjust</code> change the position of the label. Note that these are arguments to <code>geom_text()</code> and not <code>aes()</code>.</p>
<p>Overlapping labels is a common problem. The package <code>ggrepel</code> ( <a href="https://cran.r-project.org/web/packages/ggrepel/vignettes/ggrepel.html">link</a> ) solves this problem.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggrepel)

<span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">y =</span> Petal.Width, <span class="dt">x =</span> Petal.Length)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">ifelse</span>(iris<span class="op">$</span>Petal.Length <span class="op">&gt;</span><span class="st"> </span><span class="fl">6.2</span>,
                                     <span class="kw">as.character</span>(iris<span class="op">$</span>Species), <span class="st">&quot;&quot;</span>)))</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Note that you no longer use <code>geom_text()</code>. We also put the label argument within <code>geom_text_repel(aes())</code>. You can also the <code>label</code> argument within ggplot, so it is set ‘globally’.</p>
</div>
<div id="colour-points" class="section level3">
<h3><span class="header-section-number">8.2.3</span> Colour points</h3>
<p>If you use the aesthetic <code>fill</code> to colour points using a categorical variable, ggplot2 will set different colours for each category. If you use a continuous variable, ggplot2 will set a gradient scale with appropriate min and max values.</p>
<p>To colour specific points you can use <code>cut()</code> with <code>scale_colour_manual()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">y =</span> Petal.Width, <span class="dt">x =</span> Petal.Length, 
                 <span class="dt">colour =</span> <span class="kw">cut</span>(iris<span class="op">$</span>Petal.Length, <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">6</span>,<span class="dv">10</span>)))) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_colour_manual</span>(<span class="dt">name =</span> <span class="st">&quot;legend&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;black&quot;</span>))</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>The function <code>cut()</code> divides a vector into intervals. You can either specify break points (as I have above - note providing 3 numbers breaks the vector into 2 intervals) or specify the number of intervals you want, in the <code>breaks</code> argument. The result is a factor, where each level is an interval.</p>
<p>The <code>scale_colour_manual()</code> function lets you specify which colours you wish to use. You can also modify the legend by changing the name and the legend labels.</p>
<p>Here we will change the legend labels:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">y =</span> Petal.Width, <span class="dt">x =</span> Petal.Length, 
                 <span class="dt">colour =</span> <span class="kw">cut</span>(iris<span class="op">$</span>Petal.Length, <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">6</span>,<span class="dv">10</span>)))) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_colour_manual</span>(<span class="dt">name =</span> <span class="st">&quot;legend&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;black&quot;</span>), 
                      <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;less than 6&quot;</span>, <span class="st">&quot;larger than 6&quot;</span>))</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>You can also do this by calling <code>geom_point()</code> twice, specifying only selected points in the second call and setting these points to be a specific colour (see: <a href="https://stackoverflow.com/questions/11467965/r-ggplot2-highlighting-selected-points-and-strange-behavior">SO</a> ).</p>
</div>
<div id="matrix-of-plots" class="section level3">
<h3><span class="header-section-number">8.2.4</span> Matrix of plots</h3>
<p>Base R comes with the function <code>pairs()</code> which creates a matrix of scatter plots.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pairs</span>(iris[,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>])</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>The <code>GGally</code> package is an extension to <code>ggplot2</code> and has a function called <code>ggpairs()</code> which offers extra functionality, like letting you use non-continuous variables in your data frames.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(GGally)
<span class="kw">ggpairs</span>(iris, <span class="kw">aes</span>(<span class="dt">colour =</span> Species, <span class="dt">alpha =</span> <span class="fl">0.4</span>))</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
</div>
<div id="adding-lines" class="section level3">
<h3><span class="header-section-number">8.2.5</span> Adding lines</h3>
<p><code>geom_line()</code> allows you to add a simple line that joins all the points:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(iris[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,], <span class="kw">aes</span>(<span class="dt">y =</span> Petal.Length, <span class="dt">x =</span> Sepal.Length)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>To change the appearance of the line, <code>geom_line()</code> offers the following arguments:</p>
<ul>
<li>colour</li>
<li>linetype</li>
<li>size</li>
</ul>
<p>Setting <code>linetype</code> within <code>geom_line(aes())</code> allows you have different line types depending on the factor. See <a href="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/">R cookbook</a> for more details.</p>
<p><code>geom_smooth</code> allows you to fit a smooth line through all the points using various methods. The default is ‘auto’ which picks one of:</p>
<ul>
<li>lm</li>
<li>glm</li>
<li>gam</li>
<li>loess</li>
</ul>
<p>depending on the size of the largest group. A message will be output along with the plot informing the user of which method was used.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">y =</span> Petal.Width, <span class="dt">x =</span> Petal.Length)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>()</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="R_notes_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>More details can be found in the <a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">ggplot2 reference</a>.</p>
<div id="grouping" class="section level4">
<h4><span class="header-section-number">8.2.5.1</span> Grouping</h4>
<p>You may need to specify <code>aes(group())</code> within <code>geom_line()</code> if you wish to join lines within groups only.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">meanSep =</span> <span class="kw">mean</span>(Sepal.Length), <span class="dt">meanPet =</span> <span class="kw">mean</span>(Petal.Length)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">key =</span> <span class="st">&#39;type&#39;</span>, <span class="dt">value =</span> <span class="st">&#39;mean&#39;</span>)</code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   Species    type     mean
##   &lt;fct&gt;      &lt;chr&gt;   &lt;dbl&gt;
## 1 setosa     meanSep  5.01
## 2 versicolor meanSep  5.94
## 3 virginica  meanSep  6.59
## 4 setosa     meanPet  1.46
## 5 versicolor meanPet  4.26
## 6 virginica  meanPet  5.55</code></pre>
<p>This will give a warning:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">meanSep =</span> <span class="kw">mean</span>(Sepal.Length), <span class="dt">meanPet =</span> <span class="kw">mean</span>(Petal.Length)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">key =</span> <span class="st">&#39;type&#39;</span>, <span class="dt">value =</span> <span class="st">&#39;mean&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> mean, <span class="dt">x =</span> Species, <span class="dt">colour =</span> type)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<pre><code>## geom_path: Each group consists of only one observation. Do you need to
## adjust the group aesthetic?</code></pre>
<p><img src="R_notes_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>Default grouping occurs in two ways:</p>
<ul>
<li>If <code>x</code> or <code>y</code> are categorical variables, this will become the default group</li>
<li>If <code>colour</code>, <code>shape</code> or <code>fill</code> is used, data will be grouped according to the variable mapped to.</li>
</ul>
<p>In the above case, <code>x</code> was set to <code>Species</code> and <code>colour</code> to <code>type</code> - thus there is only one observation per group, as per the warning message.</p>
<p>There are a few ways to avoid default grouping:</p>
<ul>
<li>do not use map in <code>ggplot(aes())</code> as this will be applied to all layers</li>
<li>override the default grouping with the <code>group</code> parameter</li>
</ul>
<p>Here we have overriden the default grouping in the <code>geom_line()</code> geom:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">meanSep =</span> <span class="kw">mean</span>(Sepal.Length), <span class="dt">meanPet =</span> <span class="kw">mean</span>(Petal.Length)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">key =</span> <span class="st">&#39;type&#39;</span>, <span class="dt">value =</span> <span class="st">&#39;mean&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> mean, <span class="dt">x =</span> Species, <span class="dt">colour =</span> type)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> type))</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>You can also remove all grouping by setting <code>group</code> to be a constant - any one value, e.g. 1, or 123, or ‘aa’. This makes the <code>geom</code> treat all the data as one group and draw one line through all the data points. Note also that you can do this within <code>aes()</code> or outside of <code>aes()</code> as it is a constant (see section <a href="ggplot2.html#aesthetics">8.1.3</a>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">meanSep =</span> <span class="kw">mean</span>(Sepal.Length), <span class="dt">meanPet =</span> <span class="kw">mean</span>(Petal.Length)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">key =</span> <span class="st">&#39;type&#39;</span>, <span class="dt">value =</span> <span class="st">&#39;mean&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> mean, <span class="dt">x =</span> Species, <span class="dt">colour =</span> type)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">group =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>Finally, note that grouping is for <em>collective geoms</em>. Collective geoms are geoms which ‘use’ more than one row of data. In <code>geom_point()</code>, each point is one row of data, thus it is NOT a collective geom. In <code>geom_boxplo()</code>, each box uses data from many rows, thus it is a collective geom. Grouping is important for collective geoms but NOT for individual geoms.</p>
<p>(See <a href="https://www.gl-li.com/2017/08/13/ggplot2-group-overrides-default-grouping/">link</a> for more details)</p>
</div>
</div>
</div>
<div id="bar-graphs-histograms" class="section level2">
<h2><span class="header-section-number">8.3</span> Bar graphs &amp; histograms</h2>
<p>The default stat of <code>geom_bar()</code> is ‘count’, which ‘bins’ your data (puts each value into a defined ‘bin’), and then plots bin counts.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x =</span> Species)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>()</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>This tells you that there are 50 values (observations/rows) in each species group.</p>
<p><code>geom_histogram()</code> is appropriate for a continuous variable:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x =</span> Petal.Length)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_histogram</span>()</code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="R_notes_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>A message will be output with the plot telling the user which bin width has been used. To pick a binwidth, use the <code>binwidth</code> argument in <code>geom_histogram()</code> (outside of <code>aes()</code>).</p>
<p>A number of histograms can be overlayed on top of each other, though Hadley recommends that you do this with <code>geom_freqpoly()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Width, <span class="dt">colour =</span> Species)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_freqpoly</span>()</code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="R_notes_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>To plot a bar graph using absolute values (instead of frequencies), use <code>stat = 'identity'</code> (see 888 chapter for dplyr notation):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(Sepal.Length)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> mean, <span class="dt">x =</span> Species)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&#39;identity&#39;</span>)</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p>Adding <code>fill</code> argument in <code>aes()</code> will create a stacked bar graph:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Length, <span class="dt">fill =</span> Species)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>()</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p>Note: <code>fill</code> species the colour of the bar (or point) and <code>colour</code> spefies the colour of the border around the bar (or point).</p>
<p>To have the bars next to each other instead of stacked, use <code>position = 'dodge'</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(<span class="dt">x =</span> Sepal.Length, <span class="dt">fill =</span> Species)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="st">&#39;dodge&#39;</span>)</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>Note in the graph above, for lengths where not all species are present, there is only 1 bar that is wider. To fix this - google it…</p>
</div>
<div id="geom_boxplot" class="section level2">
<h2><span class="header-section-number">8.4</span> geom_boxplot</h2>
<p>Definitions: * A box that stretches from the 25th percentile of the distribution to the 75th percentile * A line (or whisker) that extends from each end of the box and goes to the farthest non-outlier point in the distribution. * Points (dots) that display observations that fall more than 1.5 times the IQR from either edge of the box. These outlying points are unusual so are plotted individually.</p>
</div>
<div id="facets" class="section level2">
<h2><span class="header-section-number">8.5</span> Facets</h2>
<p>(Back to the <code>mpg</code> dataset)</p>
<p>Another way to add variables is to split into many graphs:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">facet_wrap</span>(. <span class="op">~</span><span class="st"> </span>class, <span class="dt">nrow =</span> <span class="dv">2</span>) <span class="co"># same plot with or without dot</span></code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<p>The first argument is a ‘formula’, which you create with <code>~</code> followed by variable name. Variable should not be a continuous variable. In the above plot, leaving one side empty or using a dot means that only one variable is being facetted. The <code>nrow</code> and <code>ncol</code> arguments let you specify how many rows or columns you want.</p>
<p>If you wish to facet using two variables, <code>facet_wrap</code> will look like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">facet_wrap</span>(drv <span class="op">~</span><span class="st"> </span>class, <span class="dt">nrow =</span> <span class="dv">2</span>) <span class="co"># same plot with or without dot</span></code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<p>Graphs for all possible combinations of your two variables are created and arranged as per the <code>nrow</code> and <code>ncol</code> specification - as described by the help file: ‘Wrap a 1d ribbon of panels into 2d’. Note that only combinations where there values are shown.</p>
<p>Alternatively you can use <code>facet_grid()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">facet_grid</span>(drv <span class="op">~</span><span class="st"> </span>cyl)</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p>Here the notation is <code>(row ~ column)</code> - LHS is which variable should be horizontally facetted and RHS is which variable should be vertically facetted.</p>
<p>Note that in this case graphs for all possible combinations of the two variables are created, even though some combinations have no values (e.g. the botton left graphs have no points in them).</p>
</div>
<div id="reordering-factors" class="section level2">
<h2><span class="header-section-number">8.6</span> Reordering factors</h2>
<p>Often a specific order of factor levels is desired when plotting. This can be achieved using the base R function <code>reorder()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(
<span class="kw">reorder</span>(mpg<span class="op">$</span>manufacturer, mpg<span class="op">$</span>displ, <span class="dt">FUN =</span> max),
<span class="dt">n=</span><span class="dv">20</span>
)</code></pre></div>
<pre><code>##  [1] audi      audi      audi      audi      audi      audi      audi     
##  [8] audi      audi      audi      audi      audi      audi      audi     
## [15] audi      audi      audi      audi      chevrolet chevrolet
## 15 Levels: honda subaru hyundai volkswagen audi land rover ... chevrolet</code></pre>
<p>In the above code we have reordered the levels of <code>mpg$manufacturer</code> according to the maximum <code>mpg$displ</code> (engine displacement in litres) value of each factor group. See the <code>reorder</code> help file for more details.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(class, hwy, <span class="dt">FUN =</span> median), <span class="dt">y =</span> hwy))</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<p>In the above graph, we have reordered the levels of <code>mpg$class</code> according to their median hwy levels. You acn see in the boxplot, that the median hwy levels increase from left to right.</p>
</div>
<div id="coordinate-systems" class="section level2">
<h2><span class="header-section-number">8.7</span> Coordinate systems</h2>
<p>Default is Cartesian.</p>
<p><code>coord_flip()</code> switches axis of the graph - rotatwa graph by 90 deg. Good for graphs with long names on the x-axis. <code>coord_cartesian(ylim = c(min,max), xlim = c(min,max))</code> lets you ‘zoom’ in on a particular part of the graph.</p>
</div>
<div id="reference-lines" class="section level2">
<h2><span class="header-section-number">8.8</span> Reference lines</h2>
<p>Reference lines can be added to graphs using:</p>
<ul>
<li><code>geom_abline</code> - diagonal specified by slope and intercept (vertical and horizontal lines can also be drawn)</li>
<li><code>geom_hline</code> - horizontal line</li>
<li><code>geom_vline</code> - vertical line</li>
</ul>
<p>See <a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">ggplot reference</a> for examples.</p>
</div>
<div id="error-bars" class="section level2">
<h2><span class="header-section-number">8.9</span> Error bars</h2>
<p>To add error bars, you must specify the length of each error bar. For example, if you wished to have +/- standard deviation error bars on a bar graph, you need to have a column in your dataframe with the standard deviation for each bar.</p>
<p>If we wanted to plot the mean +/- sd of the Sepal.Length we would need a dataframe with these columns:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(Sepal.Length), <span class="dt">sd =</span> <span class="kw">sd</span>(Sepal.Length)) </code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   Species     mean    sd
##   &lt;fct&gt;      &lt;dbl&gt; &lt;dbl&gt;
## 1 setosa      5.01 0.352
## 2 versicolor  5.94 0.516
## 3 virginica   6.59 0.636</code></pre>
<p>To add the error bars, use <code>geom_eerrobar()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(Sepal.Length), <span class="dt">sd =</span> <span class="kw">sd</span>(Sepal.Length)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> mean, <span class="dt">x =</span> Species)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&#39;identity&#39;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> mean <span class="op">-</span><span class="st"> </span>sd, <span class="dt">ymax =</span> mean <span class="op">+</span><span class="st"> </span>sd))</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<p>To change the appearance of the error bar, there are many options:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(Sepal.Length), <span class="dt">sd =</span> <span class="kw">sd</span>(Sepal.Length)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> mean, <span class="dt">x =</span> Species)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&#39;identity&#39;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> mean <span class="op">-</span><span class="st"> </span>sd, <span class="dt">ymax =</span> mean <span class="op">+</span><span class="st"> </span>sd),
                <span class="dt">size =</span> <span class="fl">0.3</span>, <span class="co"># thinner lines</span>
                <span class="dt">width =</span> <span class="fl">0.2</span>, <span class="co"># how much of the bar the error bar should span</span>
                <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="fl">0.9</span>)
                )</code></pre></div>
<p><img src="R_notes_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<p><code>position_dodge()</code> preserves the vertical position of an geom while adjusting the horizontal position. (see <a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">ggplot ref</a> for more details)</p>
<p>For more examples see <a href="http://www.cookbook-r.com/Graphs/Plotting_means_and_error_bars_(ggplot2)/">R cookbook</a>.</p>
</div>
<div id="appearance" class="section level2">
<h2><span class="header-section-number">8.10</span> Appearance</h2>
<ul>
<li>Change axis name and title: <code>labs(title = &quot;MAIN TITLE&quot;, x = &quot;X-AXIS TITLE&quot;, y = &quot;Y-AXIS TITLE&quot;)</code></li>
<li>Change position of title: <code>theme(plot.title = element_text(hjust = 0.5))</code></li>
<li>Set which categories appear in barplot/boxplot: <code>xlim(&quot;Category1&quot;,&quot;Category2&quot;)</code></li>
<li>Change colour of <code>fill</code> boxplot/bars: <code>scale_fill_manual(values = c(&quot;Colour1&quot;, &quot;Colour2&quot;), name = &quot;title of Legend&quot;, labels = c(&quot;Label1&quot;,&quot;Label2&quot;))</code></li>
<li>Change names under each bar/boxplot: <code>Change names under each bar/boxplot</code></li>
<li>Change title text style: <code>theme(title = element_text(face = &quot;bold.italic&quot;, color = &quot;blue&quot;, size = 16))</code></li>
<li>Change axis name text style: <code>theme(axis.title = element_text(face = &quot;bold.italic&quot;, color = &quot;red&quot;, size = 16))</code></li>
<li>Legend title/labels: <code>scale_fill_discrete(name = &quot;Legend name&quot;, labels = c())</code></li>
<li>Angle of labels: <code>theme(axis.text.x = element_text(angle = 90, hjust = 1))</code></li>
</ul>
<p>Fonts: <a href="http://www.cookbook-r.com/Graphs/Fonts/">cookbook</a></p>
</div>
<div id="dplyr-ggplot2" class="section level2">
<h2><span class="header-section-number">8.11</span> dplyr &amp; ggplot2</h2>
<p>To make a plot for each <code>group_by()</code>, use <code>do()</code>. See 888 for more details.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">do</span>(<span class="dt">plots=</span><span class="kw">ggplot</span>(<span class="dt">data=</span>.) <span class="op">+</span>
<span class="st">         </span><span class="kw">aes</span>(<span class="dt">x=</span>Petal.Width, <span class="dt">y=</span>Petal.Length) <span class="op">+</span>
<span class="st">       </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">       </span><span class="kw">ggtitle</span>(<span class="kw">unique</span>(.<span class="op">$</span>Species))
     )</code></pre></div>
<pre><code>## Source: local data frame [3 x 2]
## Groups: &lt;by row&gt;
## 
## # A tibble: 3 x 2
##   Species    plots   
## * &lt;fct&gt;      &lt;list&gt;  
## 1 setosa     &lt;S3: gg&gt;
## 2 versicolor &lt;S3: gg&gt;
## 3 virginica  &lt;S3: gg&gt;</code></pre>
<p>The output of this is a dataframe where the first column gives the names of the groups (from the <code>group_by()</code>) and the second column is called ‘plots’ (as we specified) and each item is a plot (<code>gg</code> object).</p>
<p>To give the plot a title - the name of the group - you can either use:</p>
<ul>
<li><code>unique(.$Species)</code> - there will only be 1 species type after <code>group_by()</code></li>
<li><code>.$Species[1]</code> - this is the first row of the Species column after <code>group_by()</code></li>
</ul>
</div>
<div id="saving-graphs" class="section level2">
<h2><span class="header-section-number">8.12</span> Saving graphs</h2>
<p>Using <code>pdf()</code> or <code>png()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pdf</span>(‘name of thing.pdf’)
 
<span class="co"># Generate your plot</span>

<span class="kw">dev.off</span>() <span class="co"># this closes off the current graphic device</span></code></pre></div>
<p><code>ggsave()</code> saves the last plot that you generated. You can specify <code>width</code>, <code>height</code> and <code>units</code> - options are <code>c('in', 'cm', 'mm')</code>.</p>
<p>)</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="base-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="other-visualisation-packages.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/07-ggplot2.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["R notes.pdf", "R notes.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
